#!/usr/bin/env node
// Generated by CoffeeScript 2.5.1
(function() {
  //!/usr/bin/env coffee
  var main;

  require('../lib/prelude');

  require('../lib/parser');

  require('../lib/debug-parser');

  require('../lib/test-receiver');

  main = function(yaml = file_read('-')) {
    var args, e, n, parser, pass, start, time;
    args = _.map(args, function(a) {
      if (a === 'null') {
        return null;
      } else if (a.match(/^-?[0-9]+$/)) {
        return Number(a);
      } else {
        return a;
      }
    });
    if (process.env.DEBUG) {
      parser = new DebugParser(new TestReceiver());
    } else {
      parser = new Parser(new TestReceiver());
    }
    pass = true;
    start = timer();
    try {
      parser.parse(yaml);
    } catch (error) {
      e = error;
      warn(e);
      pass = false;
    }
    time = timer(start);
    if (yaml.match(/\n./)) {
      n = "\n";
    } else {
      n = '';
      yaml = yaml.replace(/\n$/, '\\n');
    }
    if (pass) {
      say(`PASS - '${n}${yaml}'`);
      say(parser.receiver.output());
      say(sprintf("Parse time %.5fs", time));
      return true;
    } else {
      say(`FAIL - '${n}${yaml}'`);
      say(parser.receiver.output());
      say(sprintf("Parse time %.5fs", time));
      return false;
    }
  };

  if (main(...process.argv.slice(2))) {
    exit(0);
  } else {
    exit(1);
  }

  // vim: sw=2:

}).call(this);
